/* Engram 主样式入口 */

/* Design Token 系统 */
@import './variables.css';

/* Animation System V1.0 */
@import './animations.css';

/* @tailwind base; */
@tailwind components;
@tailwind utilities;

/* ==========================================================================
   Scoped Preflight / Reset
   Strictly scoped to #engram-panel-root to prevent cleaning global ST styles
   ========================================================================== */

/* Root Isolation */
#engram-panel-root {
    @apply border-border bg-background text-foreground;
    box-sizing: border-box;
    /* Ensure we don't inherit weird line-heights or fonts globally unless we want to */
    line-height: normal;

    /*
     * Structural Styles (moved from utility classes because Tailwind 'important' scope
     * prevents utilities from applying to the root element itself)
     */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    overflow: hidden;

    /* Manual Injection of Tailwind Base Vars scoped to Root */
    --tw-border-spacing-x: 0;
    --tw-border-spacing-y: 0;
    --tw-translate-x: 0;
    --tw-translate-y: 0;
    --tw-rotate: 0;
    --tw-skew-x: 0;
    --tw-skew-y: 0;
    --tw-scale-x: 1;
    --tw-scale-y: 1;
    --tw-pan-x: ;
    --tw-pan-y: ;
    --tw-pinch-zoom: ;
    --tw-scroll-snap-strictness: proximity;
    --tw-gradient-from-position: ;
    --tw-gradient-via-position: ;
    --tw-gradient-to-position: ;
    --tw-ordinal: ;
    --tw-slashed-zero: ;
    --tw-numeric-figure: ;
    --tw-numeric-spacing: ;
    --tw-numeric-fraction: ;
    --tw-ring-inset: ;
    --tw-ring-offset-width: 0px;
    --tw-ring-offset-color: #fff;
    --tw-ring-color: rgb(59 130 246 / 0.5);
    --tw-ring-offset-shadow: 0 0 #0000;
    --tw-ring-shadow: 0 0 #0000;
    --tw-shadow: 0 0 #0000;
    --tw-shadow-colored: 0 0 #0000;
    --tw-blur: ;
    --tw-brightness: ;
    --tw-contrast: ;
    --tw-grayscale: ;
    --tw-hue-rotate: ;
    --tw-invert: ;
    --tw-saturate: ;
    --tw-sepia: ;
    --tw-drop-shadow: ;
    --tw-backdrop-blur: ;
    --tw-backdrop-brightness: ;
    --tw-backdrop-contrast: ;
    --tw-backdrop-grayscale: ;
    --tw-backdrop-hue-rotate: ;
    --tw-backdrop-invert: ;
    --tw-backdrop-opacity: ;
    --tw-backdrop-saturate: ;
    --tw-backdrop-sepia: ;
    --tw-contain-size: ;
    --tw-contain-layout: ;
    --tw-contain-paint: ;
    --tw-contain-style: ;
}

#engram-panel-root *,
#engram-panel-root ::before,
#engram-panel-root ::after {
    @apply border-border;
    box-sizing: border-box;

    /* Inject these here too just in case */
    --tw-border-spacing-x: 0;
    --tw-border-spacing-y: 0;
    --tw-translate-x: 0;
    --tw-translate-y: 0;
    --tw-rotate: 0;
    --tw-skew-x: 0;
    --tw-skew-y: 0;
    --tw-scale-x: 1;
    --tw-scale-y: 1;
    --tw-pan-x: ;
    --tw-pan-y: ;
    --tw-pinch-zoom: ;
    --tw-scroll-snap-strictness: proximity;
    --tw-gradient-from-position: ;
    --tw-gradient-via-position: ;
    --tw-gradient-to-position: ;
    --tw-ordinal: ;
    --tw-slashed-zero: ;
    --tw-numeric-figure: ;
    --tw-numeric-spacing: ;
    --tw-numeric-fraction: ;
    --tw-ring-inset: ;
    --tw-ring-offset-width: 0px;
    --tw-ring-offset-color: #fff;
    --tw-ring-color: rgb(59 130 246 / 0.5);
    --tw-ring-offset-shadow: 0 0 #0000;
    --tw-ring-shadow: 0 0 #0000;
    --tw-shadow: 0 0 #0000;
    --tw-shadow-colored: 0 0 #0000;
    --tw-blur: ;
    --tw-brightness: ;
    --tw-contrast: ;
    --tw-grayscale: ;
    --tw-hue-rotate: ;
    --tw-invert: ;
    --tw-saturate: ;
    --tw-sepia: ;
    --tw-drop-shadow: ;
    --tw-backdrop-blur: ;
    --tw-backdrop-brightness: ;
    --tw-backdrop-contrast: ;
    --tw-backdrop-grayscale: ;
    --tw-backdrop-hue-rotate: ;
    --tw-backdrop-invert: ;
    --tw-backdrop-opacity: ;
    --tw-backdrop-saturate: ;
    --tw-backdrop-sepia: ;
    --tw-contain-size: ;
    --tw-contain-layout: ;
    --tw-contain-paint: ;
    --tw-contain-style: ;
}

/*
 * Manual Reset for Engram Components
 * Only targets elements INSIDE #engram-panel-root
 */
:where(#engram-panel-root) button {
    background-color: transparent;
    background-image: none;
    border: none;
    box-shadow: none;
    color: inherit;
    font-family: inherit;
    padding: 0;
    margin: 0;
    text-shadow: none;
    border-radius: 0;
    cursor: pointer;
    line-height: inherit;
    text-transform: none;
    transform: none;
    outline: none;
}

:where(#engram-panel-root) input[type="text"],
:where(#engram-panel-root) input[type="number"],
:where(#engram-panel-root) input[type="password"],
:where(#engram-panel-root) input[type="search"],
:where(#engram-panel-root) textarea,
:where(#engram-panel-root) select {
    background-color: transparent;
    color: inherit;
    border: none;
    box-shadow: none;
    outline: none;
    appearance: none;
}

/* ==========================================================================
   Component Inputs
   ========================================================================== */

@layer components {

    .engram-input,
    .engram-select {
        all: unset;
        /* Powerful reset, use with care */
        display: block;
        box-sizing: border-box;
        font-family: var(--font-mono) !important;
        width: 100%;
    }

    .engram-input::placeholder {
        opacity: 0.5;
        color: currentColor;
    }
}

/* ==========================================================================
   Utility Overrides
   ========================================================================== */

/* Scrollbar styling for Webkit (Scoped if possible, but scrollbars are often global) */
/* We cannot scope ::-webkit-scrollbar easily to just one div in standard CSS without overflow properties on that div */
/* Assuming these are fine as they match ST mostly */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    @apply bg-background;
}

::-webkit-scrollbar-thumb {
    @apply bg-muted rounded-full;
}

::-webkit-scrollbar-thumb:hover {
    @apply bg-muted-foreground opacity-50;
}

/* ==========================================================================
   Glass Effects
   ========================================================================== */

#engram-layout-root {
    backdrop-filter: var(--glass-backdrop-filter, none);
    -webkit-backdrop-filter: var(--glass-backdrop-filter, none);
}

.glass-panel {
    position: relative;
    isolation: isolate;
}

.glass-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: -1;
    border-radius: inherit;
    background-color: var(--popover, hsl(224 30% 8%));
    opacity: 0.6;
    backdrop-filter: var(--glass-backdrop-filter, blur(12px));
    -webkit-backdrop-filter: var(--glass-backdrop-filter, blur(12px));
}

.glass-sticky {
    isolation: isolate;
}

.glass-sticky::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: -1;
    background-color: var(--background, hsl(224 30% 6%));
    opacity: 0.5;
    backdrop-filter: var(--glass-backdrop-filter, blur(16px));
    -webkit-backdrop-filter: var(--glass-backdrop-filter, blur(16px));
}

/* ==========================================================================
   Markdown Content
   ========================================================================== */

:where(#engram-panel-root) .engram-changelog-content {
    font-size: 0.85rem;
    line-height: 1.6;
    color: var(--foreground);
}

:where(#engram-panel-root) .engram-changelog-content h1,
:where(#engram-panel-root) .engram-changelog-content h2,
:where(#engram-panel-root) .engram-changelog-content h3 {
    font-weight: 600;
    margin-top: 1.5em;
    margin-bottom: 0.5em;
    color: var(--foreground);
    line-height: 1.3;
}

:where(#engram-panel-root) .engram-changelog-content h1 {
    font-size: 1.25em;
    border-bottom: 1px solid var(--border);
    padding-bottom: 0.3em;
}

:where(#engram-panel-root) .engram-changelog-content ul,
:where(#engram-panel-root) .engram-changelog-content ol {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    padding-left: 1.5em;
    list-style: disc;
}

:where(#engram-panel-root) .engram-changelog-content code {
    background-color: var(--muted);
    padding: 0.2em 0.4em;
    border-radius: 4px;
    font-family: var(--font-mono);
}

:where(#engram-panel-root) .engram-changelog-content pre {
    background: var(--muted) !important;
    padding: 1em !important;
    border-radius: 8px;
    overflow-x: auto;
    margin-bottom: 1em !important;
    border: 1px solid var(--border) !important;
}
