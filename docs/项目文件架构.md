# Engram é¡¹ç›®æ–‡ä»¶æ¶æ„

> åŸºäº **React + Vite + TypeScript** + **Tailwind CSS**ï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ã€‚

---

## ğŸ“ ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ core/                  # L3: é¢†åŸŸæ ¸å¿ƒå±‚
â”‚   â”œâ”€â”€ api/               # API ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ types.ts       # é¢„è®¾ã€æ¨¡æ¿ã€é…ç½®ç­‰ä¸šåŠ¡ç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts       # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ summarizer/        # æ€»ç»“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ SummarizerService.ts
â”‚   â”‚   â”œâ”€â”€ types.ts       # æ€»ç»“å™¨ä¸“ç”¨ç±»å‹
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ pipeline/          # æ•°æ®å¤„ç†æµæ°´çº¿ (å ä½)
â”‚   â”œâ”€â”€ rag/               # RAG æ£€ç´¢ (å ä½)
â”‚   â””â”€â”€ memory/            # è®°å¿†ç®¡ç† (å ä½)
â”‚
â”œâ”€â”€ infrastructure/        # L4: åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ STContext.ts       # ç»Ÿä¸€çš„ ST ä¸Šä¸‹æ–‡è·å– â­
â”‚   â”œâ”€â”€ STBridge.ts        # SillyTavern API æ¡¥æ¥
â”‚   â”œâ”€â”€ EventBus.ts        # å†…éƒ¨äº‹ä»¶æ€»çº¿
â”‚   â”œâ”€â”€ DexieDB.ts         # IndexedDB å­˜å‚¨
â”‚   â”œâ”€â”€ SettingsManager.ts # è®¾ç½®ç®¡ç†
â”‚   â”œâ”€â”€ ThemeManager.ts    # ä¸»é¢˜ç®¡ç†
â”‚   â”œâ”€â”€ logger/            # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ Logger.ts
â”‚   â”‚   â”œâ”€â”€ ModelLogger.ts
â”‚   â”‚   â””â”€â”€ types.ts       # æ—¥å¿—ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ tavern/            # é…’é¦† API å°è£…
â”‚       â”œâ”€â”€ EventBus.ts    # é…’é¦†äº‹ä»¶
â”‚       â”œâ”€â”€ MessageService.ts
â”‚       â”œâ”€â”€ WorldInfoService.ts
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ hooks/                 # L2: åº”ç”¨å±‚ (React Hooks)
â”‚   â”œâ”€â”€ useAPIPresets.ts   # API é¢„è®¾ç®¡ç†é€»è¾‘
â”‚   â”œâ”€â”€ useDevLog.ts       # æ—¥å¿—ç®¡ç†é€»è¾‘
â”‚   â””â”€â”€ index.ts           # ç»Ÿä¸€å¯¼å‡º
â”‚
â”œâ”€â”€ views/                 # L1: è¡¨ç°å±‚ (UI)
â”‚   â”œâ”€â”€ Layout/            # å¸ƒå±€å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ MainLayout.tsx
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â””â”€â”€ Sidebar/
â”‚   â”œâ”€â”€ Dashboard/         # ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ DevLog/            # å¼€å‘æ—¥å¿—
â”‚   â”œâ”€â”€ APIPresets/        # API é…ç½®
â”‚   â”‚   â”œâ”€â”€ APIPresetsView.tsx  # ä¸»è§†å›¾
â”‚   â”‚   â””â”€â”€ components/         # å­ç»„ä»¶
â”‚   â”œâ”€â”€ Settings/          # è®¾ç½®
â”‚   â”œâ”€â”€ Processing/        # å¤„ç†é˜Ÿåˆ—
â”‚   â”œâ”€â”€ Graph/             # å›¾è°±å¯è§†åŒ–
â”‚   â”œâ”€â”€ MemoryPanel/       # è®°å¿†é¢æ¿
â”‚   â”œâ”€â”€ MemoryStream/      # è®°å¿†æµ
â”‚   â””â”€â”€ components/        # å…±äº« UI ç»„ä»¶
â”‚       â”œâ”€â”€ PageTitle.tsx
â”‚       â””â”€â”€ TabPills.tsx
â”‚
â”œâ”€â”€ styles/                # æ ·å¼ç³»ç»Ÿ
â”‚   â”œâ”€â”€ main.css           # ä¸»å…¥å£ (Tailwind æŒ‡ä»¤)
â”‚   â”œâ”€â”€ variables.css      # CSS å˜é‡
â”‚   â”œâ”€â”€ theme.ts           # Theme ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ themes.ts          # é¢„è®¾ä¸»é¢˜
â”‚
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ index.ts           # formatTimestamp, truncateText, generateId
â”‚
â”œâ”€â”€ contexts/              # React Context
â”‚   â””â”€â”€ ThemeContext.tsx
â”‚
â”œâ”€â”€ constants/             # å¸¸é‡å®šä¹‰
â”‚
â”œâ”€â”€ App.tsx                # æ ¹ç»„ä»¶
â””â”€â”€ index.tsx              # å…¥å£
```

---

## ğŸ—ï¸ åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L1: è¡¨ç°å±‚ (views/)                            â”‚
â”‚  - UI ç»„ä»¶ï¼Œåªè´Ÿè´£æ¸²æŸ“                          â”‚
â”‚  - ä½¿ç”¨ Tailwind ä¸»é¢˜ç±»                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L2: åº”ç”¨å±‚ (hooks/)                            â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘å°è£…                                 â”‚
â”‚  - çŠ¶æ€ç®¡ç† (useAPIPresets, useDevLog ç­‰)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L3: é¢†åŸŸæ ¸å¿ƒå±‚ (core/)                         â”‚
â”‚  - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (Summarizer, RAG ç­‰)            â”‚
â”‚  - ç±»å‹å®šä¹‰ (core/api/types.ts)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L4: åŸºç¡€è®¾æ–½å±‚ (infrastructure/)               â”‚
â”‚  - å¤–éƒ¨æœåŠ¡é€‚é… (STContext, STBridge)           â”‚
â”‚  - å­˜å‚¨ (DexieDB)ã€æ—¥å¿— (Logger)ã€äº‹ä»¶ (EventBus)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç¼–ç è§„èŒƒ

### 1. ç±»å‹å®šä¹‰è§„èŒƒ

| ç±»å‹å½’å± | å­˜æ”¾ä½ç½® | ç¤ºä¾‹ |
|----------|----------|------|
| API ä¸šåŠ¡ç±»å‹ | `core/api/types.ts` | LLMPreset, PromptTemplate |
| æ¨¡å—ä¸“ç”¨ç±»å‹ | æ¨¡å—å†… `types.ts` | SummarizerConfig |
| åŸºç¡€è®¾æ–½ç±»å‹ | æ‰€å±æ¨¡å—å†… | LogEntry, STContext |
| UI ç›¸å…³ç±»å‹ | `styles/theme.ts` | Theme |

### 2. ç›®å½•è§„èŒƒ

| è§„åˆ™ | è¯´æ˜ |
|------|------|
| å•æ–‡ä»¶ä¸å»ºç›®å½• | å¦‚ `FormField.tsx` ç›´æ¥æ”¾ `components/` ä¸‹ï¼Œä¸éœ€è¦ `FormField/index.tsx` |
| å¤šæ–‡ä»¶éœ€ç›®å½• | æœ‰å­ç»„ä»¶æˆ–æ ·å¼æ—¶æ‰å»ºç›®å½• |
| è§†å›¾å…¥å£å‘½å | ä½¿ç”¨ `*View.tsx` æˆ– `index.tsx` |
| å¯¼å‡ºç»Ÿä¸€ | æ¯ä¸ªç›®å½•ç”¨ `index.ts` ç»Ÿä¸€å¯¼å‡º |

### 3. Hooks è§„èŒƒ

**ä¸šåŠ¡é€»è¾‘åº”æå–åˆ° Hooks**ï¼Œè§†å›¾åªè´Ÿè´£æ¸²æŸ“ï¼š

```tsx
// âŒ é”™è¯¯ï¼šè§†å›¾åŒ…å«ä¸šåŠ¡é€»è¾‘
const APIPresets = () => {
    const [settings, setSettings] = useState(...);
    const handleAdd = () => { /* å¤æ‚é€»è¾‘ */ };
    // 100+ è¡Œé€»è¾‘...
}

// âœ… æ­£ç¡®ï¼šé€»è¾‘åœ¨ Hook ä¸­
const APIPresets = () => {
    const { settings, addPreset, ... } = useAPIPresets();
    // åªæœ‰æ¸²æŸ“ä»£ç 
}
```

### 4. æ ·å¼è§„èŒƒ

- **ä½¿ç”¨ Tailwind ä¸»é¢˜ç±»**ï¼š`bg-background`, `text-foreground`, `border-border`
- **ç¦æ­¢ç¡¬ç¼–ç é¢œè‰²**ï¼šä¸ä½¿ç”¨ `bg-black`, `text-zinc-*` ç­‰
- **å…±äº«æ ·å¼**ï¼šåœ¨ `main.css` çš„ `@layer components` ä¸­å®šä¹‰

---

## ğŸ”Œ å…³é”®æ¨¡å—è¯´æ˜

### STContext.ts
**å”¯ä¸€çš„ SillyTavern ä¸Šä¸‹æ–‡è·å–å…¥å£**ï¼Œæ¶ˆé™¤é‡å¤ä»£ç ï¼š
- `getSTContext()` - è·å– ST ä¸Šä¸‹æ–‡
- `getCurrentChat()` - è·å–èŠå¤©è®°å½•
- `getCurrentCharacter()` - è·å–å½“å‰è§’è‰²
- `isSTAvailable()` - æ£€æŸ¥å¯ç”¨æ€§

### Hooks ç›®å½•
| Hook | åŠŸèƒ½ |
|------|------|
| `useAPIPresets` | API é¢„è®¾ CRUDã€é…ç½®ç®¡ç† |
| `useDevLog` | æ—¥å¿—è®¢é˜…ã€è¿‡æ»¤ã€å¯¼å‡º |

---

## ğŸ“Š æ„å»ºäº§ç‰©

```
dist/
â”œâ”€â”€ index.js           # ä¸» JS åŒ…
â”œâ”€â”€ style.css          # æ ·å¼
â””â”€â”€ *.js               # ä»£ç åˆ†å‰²çš„ chunks
```

æ„å»ºå‘½ä»¤ï¼š`npm run build`