# Engram é¡¹ç›®æ–‡ä»¶æ¶æ„

> åŸºäº **React + Vite + TypeScript** + **Tailwind CSS**ï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ã€‚
> **æœ€åæ›´æ–°**: 2026-01-01 (é‡æ„å)

---

## ğŸ“ ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ assets/                # é™æ€èµ„æº
â”‚   â”œâ”€â”€ icons/             # SVG å›¾æ ‡ç»„ä»¶ (EngramIcon, EngramTextLogo)
â”‚   â””â”€â”€ styles/            # å…¨å±€æ ·å¼ç»„ä»¶ (GlobalStyles)
â”‚
â”œâ”€â”€ components/            # çº¯å±•ç¤ºç»„ä»¶ (19ä¸ª)
â”‚   â”œâ”€â”€ ui/                # åŸå­ç»„ä»¶ (Button, Switch, Modal, TabPills)
â”‚   â”œâ”€â”€ layout/            # å¸ƒå±€ç»„ä»¶ (MainLayout, Header, Sidebar)
â”‚   â”œâ”€â”€ visual/            # è§†è§‰ç»„ä»¶ (NeuralOrb, WelcomeAnimation)
â”‚   â””â”€â”€ common/            # é€šç”¨ç»„ä»¶ (ItemCard, ItemList, PageTitle)
â”‚
â”œâ”€â”€ lib/                   # æ— ä¸šåŠ¡é€»è¾‘çš„å·¥å…·åº“ (5ä¸ª)
â”‚   â”œâ”€â”€ logger/            # æ—¥å¿—ç³»ç»Ÿ (Logger, ModelLogger)
â”‚   â””â”€â”€ events.ts          # åº”ç”¨å†…éƒ¨äº‹ä»¶æ€»çº¿
â”‚
â”œâ”€â”€ services/              # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (28ä¸ª)
â”‚   â”œâ”€â”€ api/               # LLM API äº¤äº’ (types, prompts, ModelDiscovery)
â”‚   â”œâ”€â”€ database/          # æ•°æ®åº“ (db.ts - Dexie)
â”‚   â”œâ”€â”€ summarizer/        # æ€»ç»“æœåŠ¡ (SummarizerService, TrimmerService)
â”‚   â”œâ”€â”€ settings/          # è®¾ç½®æŒä¹…åŒ– (Persistence.ts)
â”‚   â”œâ”€â”€ updater/           # æ›´æ–°æ£€æŸ¥
â”‚   â”œâ”€â”€ pipeline/          # æ•°æ®æµæ°´çº¿ [å ä½]
â”‚   â”œâ”€â”€ rag/               # RAG æ£€ç´¢ [å ä½]
â”‚   â””â”€â”€ memory/            # è®°å¿†ç®¡ç† [å ä½]
â”‚
â”œâ”€â”€ tavern/                # SillyTavern é€‚é…å±‚ (6ä¸ª) â­
â”‚   â”œâ”€â”€ bridge.ts          # å”¯ä¸€çš„ window.SillyTavern å…¥å£
â”‚   â”œâ”€â”€ context.ts         # ST ä¸Šä¸‹æ–‡è·å– (getSTContext)
â”‚   â”œâ”€â”€ TavernEvents.ts    # é…’é¦†äº‹ä»¶å°è£…
â”‚   â””â”€â”€ api/               # é…’é¦† API å°è£…
â”‚       â”œâ”€â”€ Message.ts     # æ¶ˆæ¯æœåŠ¡
â”‚       â”œâ”€â”€ WorldInfo.ts   # ä¸–ç•Œä¹¦æœåŠ¡
â”‚       â””â”€â”€ index.ts       # ç»Ÿä¸€å¯¼å‡º
â”‚
â”œâ”€â”€ types/                 # ç±»å‹å®šä¹‰ (24ä¸ª)
â”‚   â”œâ”€â”€ global.d.ts        # Window æ‰©å±•å£°æ˜
â”‚   â””â”€â”€ st-types/          # SillyTavern ç±»å‹ (23ä¸ª .d.ts)
â”‚
â”œâ”€â”€ views/                 # é¡µé¢çº§è§†å›¾
â”‚   â”œâ”€â”€ Dashboard/         # ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ Processing/        # å¤„ç† (æ€»ç»“/ç²¾ç®€)
â”‚   â”œâ”€â”€ APIPresets/        # API é…ç½®
â”‚   â”œâ”€â”€ Settings/          # è®¾ç½®
â”‚   â”œâ”€â”€ DevLog/            # å¼€å‘æ—¥å¿—
â”‚   â”œâ”€â”€ Graph/             # å›¾è°±å¯è§†åŒ–
â”‚   â””â”€â”€ MemoryStream/      # è®°å¿†æµ
â”‚
â”œâ”€â”€ hooks/                 # React Hooks
â”œâ”€â”€ contexts/              # React Context (ThemeContext)
â”œâ”€â”€ constants/             # å¸¸é‡é…ç½® (navigation, commands)
â”œâ”€â”€ styles/                # æ ·å¼ (main.css, themes.ts)
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ App.tsx                # æ ¹ç»„ä»¶ (æ”¯æŒæ‡’åŠ è½½)
â””â”€â”€ index.tsx              # å…¥å£
```

---

---

## ğŸ—ï¸ åˆ†å±‚æ¶æ„ (Update)

ç³»ç»Ÿé‡‡ç”¨å•å‘ä¾èµ–æµï¼Œä¸¥ç¦è·¨å±‚å¾ªç¯ä¾èµ–ã€‚

```mermaid
graph TD
    L1_UI[L1: è¡¨ç°å±‚ (views/)] --> L2_Hook[L2: åº”ç”¨å±‚ (hooks/)]
    L1_UI --> L3_Store[L3: çŠ¶æ€å±‚ (stores/)]
    L2_Hook --> L3_Store
    L2_Hook --> L4_Service[L4: ä¸šåŠ¡å±‚ (services/)]
    L4_Service --> L5_Infra[L5: åŸºç¡€è®¾æ–½å±‚ (lib/ & tavern/)]
    L4_Service --> L5_DB[database/]
```

| å±‚çº§ | ç›®å½• | èŒè´£ | ä¾èµ–è§„åˆ™ |
|------|------|------|----------|
| **L1 è¡¨ç°å±‚** | `views/`, `components/` | UI æ¸²æŸ“ï¼Œäº¤äº’äº‹ä»¶ handling | å¯è°ƒç”¨ hooks, stores |
| **L2 åº”ç”¨å±‚** | `hooks/` | å°†ä¸šåŠ¡é€»è¾‘å°è£…ä¸º React API | å¯è°ƒç”¨ stores, services |
| **L3 çŠ¶æ€å±‚** | `stores/` | å…¨å±€çŠ¶æ€ç®¡ç† (Zustand) | å¯è°ƒç”¨ services |
| **L4 ä¸šåŠ¡å±‚** | `services/` | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œçº¯ TS å®ç° | å¯è°ƒç”¨ lib, tavern |
| **L5 åŸºç¡€å±‚** | `lib/`, `tavern/` | åº•å±‚å·¥å…·ï¼Œå¤–éƒ¨ API é€‚é… | **ä¸å¯ä¾èµ–ä¸Šå±‚** |

---

## ğŸ“ ç¼–ç è§„èŒƒ

**ä¸šåŠ¡é€»è¾‘åº”æå–åˆ° Hooks**ï¼Œè§†å›¾åªè´Ÿè´£æ¸²æŸ“ï¼š

```tsx
// âŒ é”™è¯¯ï¼šè§†å›¾åŒ…å«ä¸šåŠ¡é€»è¾‘
const APIPresets = () => {
    const [settings, setSettings] = useState(...);
    const handleAdd = () => { /* å¤æ‚é€»è¾‘ */ };
    // 100+ è¡Œé€»è¾‘...
}

// âœ… æ­£ç¡®ï¼šé€»è¾‘åœ¨ Hook ä¸­
const APIPresets = () => {
    const { settings, addPreset, ... } = useAPIPresets();
    // åªæœ‰æ¸²æŸ“ä»£ç 
}
```

### 4. æ ·å¼è§„èŒƒ

- **ä½¿ç”¨ Tailwind ä¸»é¢˜ç±»**ï¼š`bg-background`, `text-foreground`, `border-border`
- **ç¦æ­¢ç¡¬ç¼–ç é¢œè‰²**ï¼šä¸ä½¿ç”¨ `bg-black`, `text-zinc-*` ç­‰
- **å…±äº«æ ·å¼**ï¼šåœ¨ `main.css` çš„ `@layer components` ä¸­å®šä¹‰

---

## ğŸ”Œ å…³é”®æ¨¡å—è¯´æ˜

### STContext.ts
**å”¯ä¸€çš„ SillyTavern ä¸Šä¸‹æ–‡è·å–å…¥å£**ï¼Œæ¶ˆé™¤é‡å¤ä»£ç ï¼š
- `getSTContext()` - è·å– ST ä¸Šä¸‹æ–‡
- `getCurrentChat()` - è·å–èŠå¤©è®°å½•
- `getCurrentCharacter()` - è·å–å½“å‰è§’è‰²
- `isSTAvailable()` - æ£€æŸ¥å¯ç”¨æ€§

### Hooks ç›®å½•
| Hook | åŠŸèƒ½ |
|------|------|
| `useAPIPresets` | API é¢„è®¾ CRUDã€é…ç½®ç®¡ç† |
| `useDevLog` | æ—¥å¿—è®¢é˜…ã€è¿‡æ»¤ã€å¯¼å‡º |

---

## ğŸ“Š æ„å»ºäº§ç‰©

```
dist/
â”œâ”€â”€ index.js           # ä¸» JS åŒ…
â”œâ”€â”€ style.css          # æ ·å¼
â””â”€â”€ *.js               # ä»£ç åˆ†å‰²çš„ chunks
```

æ„å»ºå‘½ä»¤ï¼š`npm run build`