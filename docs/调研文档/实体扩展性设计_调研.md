# Engram 实体扩展性设计调研

> **状态**: 调研文档 (V1.0+ 规划)  
> **日期**: 2026-01-13

---

## 1. 目标

让 `EntityNode` 成为一个**开放的数据容器**，允许外部扩展（如好感度系统、生理系统等）添加自定义属性。

类似 RimWorld 的 Pawn + Comp 系统，或 Unity 的 ECS。

---

## 2. 设计方案

### 推荐方案：命名空间隔离 + 轻量 API

```typescript
// 1. 数据结构
interface EntityNode {
    // 核心字段
    id: string;
    name: string;
    type: EntityType;
    // ...
    
    // 扩展容器（命名空间隔离）
    ext: {
        [namespace: string]: Record<string, unknown>;
    };
}

// 2. 公共 API
window.EngramEntity = {
    async getByName(name: string): Promise<EntityNode | null>;
    async getById(id: string): Promise<EntityNode | null>;
    async getExt<T>(entityId: string, namespace: string): Promise<T | null>;
    async setExt<T>(entityId: string, namespace: string, data: T): Promise<void>;
    onEntityUpdated(callback): () => void;
};

// 3. 使用示例
await window.EngramEntity.setExt(entityId, 'affinity_system', { value: 50 });
```

---

## 3. V0.9 预留

在 `EntityNode` 中预留字段：

```typescript
ext?: Record<string, unknown>;
```

不做复杂的 API，等核心功能稳定后再实现。

---

## 4. 后续实现清单

- [ ] 实现 `window.EngramEntity` API
- [ ] 实现事件订阅机制
- [ ] 编写扩展开发文档
- [ ] 提供 TypeScript 类型声明包
